---
- name: Configure EC2 with Docker and Nginx
  hosts: web
  become: yes

  tasks:
      - name: Install dependencies
        apt:
            name:
                [
                    "apt-transport-https",
                    "ca-certificates",
                    "curl",
                    "software-properties-common",
                ]
            state: present
            update_cache: yes

      - name: Add Docker GPG key
        apt_key:
            url: https://download.docker.com/linux/ubuntu/gpg
            state: present

      - name: Add Docker repository
        apt_repository:
            repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable
            state: present

      - name: Install Docker
        apt:
            name: docker-ce
            state: latest
            update_cache: yes

      - name: Start and enable Docker
        systemd:
            name: docker
            enabled: yes
            state: started

      - name: Pull Nginx Docker image
        docker_image:
            name: nginx
            source: pull

      - name: Run Nginx container
        docker_container:
            name: nginx
            image: nginx
            state: started
            ports:
                - "80:80"
